{
  "$schema": "https://json-schema.org/draft/next/schema",
  "$id": "https://json-schema.org/draft/next/output/schema",
  "description": "A schema that validates the minimum requirements for validation output",

  "anyOf": [
    { "$ref": "#/$defs/flag" },
    { "$ref": "#/$defs/basic" },
    { "$ref": "#/$defs/schemaHierarchy" },
    { "$ref": "#/$defs/instanceHierarchy" }
  ],
  "$defs": {
    "outputUnit":{
      "properties": {
        "valid": { "type": "boolean" },
        "keyword": { "type": "string" },
        "dialect": {
          "type": "string",
          "format": "uri"
        },
        "validationPath": {
          "type": "string",
          "format": "json-pointer"
        },
        "schemaLocation": {
          "type": "string",
          "format": "uri"
        },
        "instanceLocation": {
          "type": "string",
          "format": "json-pointer"
        },
        "error": {
          "type": "string"
        },
        "annotation": true,
        "collectedAnnotations": {
          "type": "object",
          "propertyNames": {
            "type": "string",
            "format": "uri"
          }
        }
      },
      "required": [ "valid", "validationPath", "schemaLocation", "instanceLocation" ],
      "if": { "properties": { "valid": { "const": true } } },
      "then": { "properties": { "error": false } },
      "else": {
        "properties": {
          "annotation": false,
          "collectedAnnotations": false
        }
      }
    },
    "schemaStructure": {
      "$ref": "#/$defs/outputUnit",
      "properties": {
        "nested": {
          "type": "array",
          "items": { "$ref": "#/$defs/schemaStructure" }
        }
      }
    },
    "instanceStructure": {
      "$ref": "#/$defs/outputUnit",
      "properties": {
        "results": {
          "type": "array",
          "items": { "$ref": "#/$defs/outputUnit" }
        },
        "nested": {
          "type": "object",
          "propertyNames": {
            "type": "string",
            "format": "json-pointer"
          },
          "additionalProperties": { "$ref": "#/$defs/instanceStructure" }
        }
      }
    },
    
    "flag": {
      "properties": {
        "valid": { "type": "boolean" }
      },
      "required": [ "valid" ],
      "additionalProperties": false
    },
    "basic": { "$ref": "#/$defs/outputUnit" },
    "schemaHierarchy": { "$ref": "#/$defs/schemaStructure" },
    "instanceHierarchy": { "$ref": "#/$defs/instanceStructure" }
  }
}
